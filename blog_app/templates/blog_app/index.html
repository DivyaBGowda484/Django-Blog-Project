{% extends "base.html" %}

{% block content %}

    <!-- Posts heading with "Create New Post" button to the right -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h2>Posts</h2>
        {% if user.is_authenticated %}
            <a href="{% url 'create_post' %}" class="btn btn-primary">Create New Post</a>
        {% endif %}
    </div>

    <!-- Search bar -->
    <form method="get" style="margin-bottom: 1.5rem;">
        <input type="text" name="q" placeholder="Search posts..." value="{{ query }}">
        <button type="submit">Search</button>
    </form>

    <hr>

    <!-- Post list -->
    <ul>
    {% for post in posts %}
    <li style="margin-bottom: 2rem;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h3>{{ post.title }}</h3>
                <p>{{ post.content|truncatewords:20 }}</p>
                <p>By: {{ post.author.username }}</p>
                <small>Published: {{ post.created_at }}</small><br>
                <small>Updated: {{ post.updated_at }}</small><br>
                {% if user == post.author %}
                    <a href="{% url 'update_post' post.pk %}">Update</a>
                    <a href="{% url 'delete_post' post.pk %}">Delete</a>
                {% endif %}
            </div>
            <div>
                <a href="{% url 'post_detail' post.id %}">
                    <button>View Full Post</button>
                </a>
            </div>
        </div>
    </li>
    <hr>
    {% empty %}
    <p>No posts found.</p>
    {% endfor %}
    </ul>

    <!-- Pagination -->
    <div class="pagination">
    {% if posts.has_previous %}
        <a href="?page=1">First</a>
        <a href="?page={{ posts.previous_page_number }}">Previous</a>
    {% endif %}

    <span>Page {{ posts.number }} of {{ posts.paginator.num_pages }}</span>

    {% if posts.has_next %}
        <a href="?page={{ posts.next_page_number }}">Next</a>
        <a href="?page={{ posts.paginator.num_pages }}">Last</a>
    {% endif %}
    </div>

{% endblock content %}
